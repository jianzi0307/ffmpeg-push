(function(e){function t(t){for(var i,a,c=t[0],s=t[1],l=t[2],u=0,h=[];u<c.length;u++)a=c[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&h.push(r[a][0]),r[a]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={index:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var d=s;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},"168c":function(e,t,n){},1712:function(e,t,n){"use strict";n("2770")},2:function(e,t){},2091:function(e,t,n){},"21fd":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="21fd"},2770:function(e,t,n){},"2a1a":function(e,t,n){"use strict";n("168c")},3:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("d052"),n("e07b"),n("0fec"),n("c838");var i=n("430a"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},o=[],a=n("cba8"),c={},s=Object(a["a"])(c,r,o,!1,null,null,null),l=s.exports,d=n("a5e4"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wsFlv"},[e.paramCheckedOk?n("div",[n(e.currentComponent,{tag:"component",style:{width:e.width+"px",height:e.height+"px"},attrs:{wsUri:e.wsUri,rtspUrl:e.hikCamera.getRtspUrl(),videoObjectFit:e.videoObjectFit}})],1):n("div",{staticClass:"empty",style:{width:e.width+"px",height:e.height+"px"}},[e._v("参数错误")])])},h=[],f=(n("6236"),n("4e2c"),n("e54e"),n("97ee")),p=n("b42e"),v=(n("3b32"),function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8e3,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"main",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"admin",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"Admin123",s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;Object(f["a"])(this,e),this.channel=t,this.username=a,this.password=c,this.name=n,this.ipAddress=i,this.devChannel=s,this.port=r,this.protocol="HIKVISION",this.videoType="h264",this.streamType=o}return Object(p["a"])(e,[{key:"getRtspUrl",value:function(){var e=this.username,t=this.password,n=this.channel,i=this.ipAddress,r=this.port,o=this.videoType,a=this.streamType;return"rtsp://".concat(e,":").concat(t,"@").concat(i,":").concat(r,"/").concat(o,"/ch").concat(n,"/").concat(a,"/av_stream")}},{key:"getNvrTracksUrl",value:function(e,t){var n=this.username,i=this.password,r=this.channel,o=this.ipAddress,a=this.port;return"rtsp://".concat(n,":").concat(i,"@").concat(o,":").concat(a,"/Streaming/tracks/").concat(r,"01?starttime=").concat(e,"&endtime=").concat(t)}}]),e}()),m=v,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("video",{ref:"video",staticClass:"player",style:{objectFit:e.videoObjectFit,width:"480px",height:"320px"},attrs:{autoplay:"",muted:""},domProps:{muted:!0}})},b=[],g=n("33aa"),w=n.n(g),P=n("bdc9"),_=n.n(P),S={name:"ws-flv-player",props:{wsUri:{type:String,required:!0},rtspUrl:{type:String,required:!0},videoObjectFit:{type:String,default:"fill"}},data:function(){return{flvPlayer:null,lastTimeStamp:0,currTimeStamp:0}},mounted:function(){var e=this;this.$nextTick((function(){e.createVideo()}))},beforeDestroy:function(){document.removeEventListener("visibilitychange",this.pageHiddenHandler,!1),this.flvPlayer&&this.flvPlayer.destroy()},methods:{createVideo:function(){if(w.a.isSupported()){var e=this.$refs.video,t=this.wsUri,n=this.rtspUrl,i=_()(n);this.flvPlayer=w.a.createPlayer({type:"flv",enableWorker:!0,stashInitialSize:128,enableStashBuffer:!1,isLive:!0,hasAudio:!1,hasVideo:!0,url:"".concat(t,"/rtsp/").concat(i,"/?url=").concat(n)}),this.flvPlayer.attachMediaElement(e);try{this.flvPlayer.load(),this.flvPlayer.play()}catch(r){console.log(r)}document.addEventListener("visibilitychange",this.pageHiddenHandler,!1)}},pageHiddenHandler:function(e){if(this.lastTimeStamp=e.timeStamp,"visible"===document.visibilityState){var t=this.$refs.video,n=t.buffered;n&&n.length>0&&(t.currentTime=n.end(0)-.5)}}}},O=S,E=(n("9cac"),Object(a["a"])(O,y,b,!1,null,"b2b66c9a",null)),k=E.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("video",{ref:"video",staticClass:"player",style:{objectFit:e.videoObjectFit},attrs:{autoplay:"",muted:""},domProps:{muted:!0}})},C=[],j=n("2ac3"),U=n.n(j),A=n("6184"),R=n.n(A),F=function(){function e(t,n,i){Object(f["a"])(this,e),this.wsUri=t,this.rtspUri=n,this.el=i}return Object(p["a"])(e,[{key:"start",value:function(){var e=this,t={remoteVideo:this.el};this.webRtcPeer=U.a.WebRtcPeer.WebRtcPeerRecvonly(t,(function(t){if(t)return console.error(t,"<<<这里报错了");e.webRtcPeer.generateOffer((function(t,n){e._onOffer(t,n)})),e.webRtcPeer.peerConnection.addEventListener("iceconnectionstatechange",(function(t){e.webRtcPeer&&e.webRtcPeer.peerConnection&&(console.log("oniceconnectionstatechange",t,"<<<<<"),console.log("oniceconnectionstatechange -> "+e.webRtcPeer.peerConnection.iceConnectionState),console.log("icegatheringstate -> "+e.webRtcPeer.peerConnection.iceGatheringState))}))}))}},{key:"stop",value:function(){this.webRtcPeer&&(this.webRtcPeer.dispose(),this.webRtcPeer=null),this.pipeline&&(this.pipeline.release(),this.pipeline=null)}},{key:"_onOffer",value:function(e,t){var n=this;if(e)return this._onError(e);R()(this.wsUri,(function(e,i){if(e)return n._onError(e);i.create("MediaPipeline",(function(e,i){n._createMediaPipeline(e,i,t)}))}))}},{key:"_createMediaPipeline",value:function(e,t,n){var i=this;if(e)return this._onError(e);this.pipeline=t,this.pipeline.create("PlayerEndpoint",{uri:this.rtspUri},(function(e,t){if(e)return i._onError(e);i.pipeline.create("WebRtcEndpoint",(function(e,r){if(e)return i._onError(e);i.setIceCandidateCallbacks(r,i.webRtcPeer,(function(e){if(e)return i._onError(e)})),r.processOffer(n,(function(e,t){if(e)return i._onError(e);r.gatherCandidates((function(e){if(e)return i._onError(e)})),i.webRtcPeer.processAnswer(t)})),t.connect(r,(function(e){if(e)return i._onError(e);console.log("PlayerEndpoint--\x3eWebRtcEndpoint connection established"),t.play((function(e){if(e)return i._onError(e);console.log("Player playing ...")}))}))}))}))}},{key:"setIceCandidateCallbacks",value:function(e,t,n){t.on("icecandidate",(function(t){console.log("Local icecandidate "+JSON.stringify(t)),t=R.a.register.complexTypes.IceCandidate(t),e.addIceCandidate(t,n)})),e.on("OnIceCandidate",(function(e){var i=e.candidate;console.log("Remote icecandidate "+JSON.stringify(i)),t.addIceCandidate(i,n)}))}},{key:"_onError",value:function(e){e&&(console.error(e,"<<< 报错了释放资源"),this.stop())}}]),e}(),T=F,I={name:"webrtc-player",props:{wsUri:{type:String,required:!0},rtspUrl:{type:String,required:!0},videoObjectFit:{type:String,default:"fill"}},data:function(){return{kurento:null}},mounted:function(){var e=this.$refs.video;this.kurento=new T(this.wsUri,this.rtspUrl,e),this.kurento.start(),document.addEventListener("visibilitychange",this.pageHiddenHandler,!1)},beforeDestroy:function(){document.removeEventListener("visibilitychange",this.pageHiddenHandler,!1),this.kurento.stop()},methods:{pageHiddenHandler:function(e){if("visible"===document.visibilityState){var t=this.$refs.video,n=t.buffered;n&&n.length>0&&(t.currentTime=n.end(0)-.5)}}}},$=I,M=(n("ddf8"),Object(a["a"])($,x,C,!1,null,"f9b8fcde",null)),N=M.exports,q={name:"EndPoint",components:{"webrtc-player":N,"ws-flv-player":k},data:function(){return{hikCamera:void 0,videoObjectFit:"fill",width:320,height:180}},computed:{paramCheckedOk:function(){var e;return this.hikCamera&&(null===(e=this.hikCamera)||void 0===e?void 0:e.channel)>0&&this.hikCamera.ipAddress&&this.hikCamera.port>0},currentComponent:function(){var e=this.$qsParse(window.location.href.split("?")[1]);return"webrtc"===(null===e||void 0===e?void 0:e.mode)?"webrtc-player":"ws-flv-player"},wsUri:function(){var e=this.$qsParse(window.location.href.split("?")[1]),t=Object({NODE_ENV:"production",VUE_APP_ENV_MODE:"online",VUE_APP_KMS_URI:"ws://180.76.134.252:8888/kurento",VUE_APP_FFMPEG_URI:"ws://172.31.129.182:8889",BASE_URL:""}),n=(t.VUE_APP_FFMPEG_URI,t.VUE_APP_KMS_URI),i=window.location.host,r="ws://".concat(i);return"webrtc"===(null===e||void 0===e?void 0:e.mode)?n:r}},mounted:function(){var e=this.$qsParse(window.location.href.split("?")[1]);this.width=(null===e||void 0===e?void 0:e.width)||320,this.height=(null===e||void 0===e?void 0:e.height)||180,this.videoObjectFit=(null===e||void 0===e?void 0:e.fit)||"fill";var t=e.channel,n=void 0===t?-1:t,i=e.name,r=void 0===i?"":i,o=e.ipAddress,a=void 0===o?"123.160.10.227":o,c=e.port,s=void 0===c?524:c,l=e.streamType,d=void 0===l?"sub":l,u=e.username,h=void 0===u?"admin":u,f=e.password,p=void 0===f?"Admin123":f,v=e.devChannel,y=void 0===v?1:v;this.hikCamera=new m(n,r,a,s,d,h,p,y),console.log(this.hikCamera.getRtspUrl(),"<hikCamera")}},V=q,H=(n("2a1a"),Object(a["a"])(V,u,h,!1,null,"de4eabc2",null)),L=H.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"font-size":"0%"}},[e._l(e.list,(function(e,t){return[n("NginxFlvPlayer",{key:t,style:{border:"solid 1px #ccc",backgroundColor:"black",width:"480px",height:"270px"},attrs:{domKey:t,liveIpAddr:"180.76.134.252",livePort:"9938",rtmpPort:"9909",liveApp:"live",liveStream:e}})]}))],2)},K=[],W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("video",{style:{objectFit:e.videoObjectFit},attrs:{autoplay:"",id:"video_"+e.domKey,muted:""},domProps:{muted:!0}})},B=[],J=(n("9188"),{name:"nginx-flv-player",props:{domKey:{type:[Number,String],required:!0},liveProtocol:{type:String,default:"http"},liveIpAddr:{type:String,required:!0},livePort:{type:[Number,String],required:!0},rtmpPort:{type:[Number,String],required:!0},liveApp:{type:[Number,String],required:!0},liveStream:{type:[String,Number],required:!0},videoObjectFit:{type:String,default:"fill"}},data:function(){return{flvPlayer:null}},mounted:function(){var e=this;this.$nextTick((function(){e.createVideo()}))},beforeDestroy:function(){this.destroy()},methods:{load:function(){this.flvPlayer&&this.flvPlayer.load()},play:function(){this.flvPlayer&&this.flvPlayer.play()},pause:function(){this.flvPlayer&&this.flvPlayer.destroy()},destroy:function(){this.flvPlayer&&this.flvPlayer.destroy()},createVideo:function(){if(w.a.isSupported()){var e=this.domKey,t=this.liveProtocol,n=this.liveIpAddr,i=this.livePort,r=this.rtmpPort,o=this.liveApp,a=this.liveStream,c=document.getElementById("video_".concat(e));this.flvPlayer=w.a.createPlayer({type:"flv",enableWorker:!0,isLive:!0,hasAudio:!1,hasVideo:!0,stashInitialSize:128,enableStashBuffer:!1,url:"".concat(t,"://").concat(n,":").concat(i,"/").concat(o,"?port=").concat(r,"&app=").concat(o,"&stream=").concat(a)}),this.flvPlayer.attachMediaElement(c),this.flvPlayer.load(),this.flvPlayer.play()}}}}),z=J,G=(n("1712"),Object(a["a"])(z,W,B,!1,null,"537be3a6",null)),Q=G.exports,X={components:{NginxFlvPlayer:Q},data:function(){return{list:[101,102,103]}},mounted:function(){},methods:{}},Y=X,Z=Object(a["a"])(Y,D,K,!1,null,null,null),ee=Z.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("div",[e._v("flv测试")]),e._l(e.cameras,(function(e,t){return[n("iframe",{key:t,ref:"iframe"+t,refInFor:!0,staticStyle:{border:"solid 1px #ccc",margin:"0",float:"left",width:"320px",height:"180px"},attrs:{frameboder:"0",src:"/#/?mode=flv&channel="+e.channel+"&ipAddress="+e.ipAddress+"&port="+e.port+"&streamType=sub&width=320&height=180"}})]})),n("div",{staticStyle:{clear:"both"}}),n("div",[e._v("webrtc测试")]),e._l(e.cameras,(function(e,t){return[n("iframe",{key:t,ref:"iframe"+t,refInFor:!0,staticStyle:{border:"solid 1px #ccc",margin:"0",float:"left",width:"320px",height:"180px"},attrs:{frameboder:"0",src:"/#/?mode=webrtc&channel="+e.channel+"&ipAddress="+e.ipAddress+"&port="+e.port+"&streamType=sub&width=320&height=180"}})]})),n("div",{staticStyle:{clear:"both"}})],2),n("div")])},ne=[],ie=(n("89a6"),n("f132"),n("e904"),{data:function(){return{mode:"webrtc",cameras:[]}},mounted:function(){var e=Array.from(Array(38),(function(e,t){return{channel:t+1,ipAddress:"123.160.10.227",port:524}}));this.cameras=this.getRandomArrayElements(e,3)},methods:{handleReload:function(e){for(var t in this.$refs)this.$refs[t][0].contentWindow.location.reload()},getRandomArrayElements:function(e,t){var n,i,r=e.slice(0),o=e.length,a=o-t;while(o-- >a)i=Math.floor((o+1)*Math.random()),n=r[i],r[i]=r[o],r[o]=n;return r.slice(a)}}}),re=ie,oe=Object(a["a"])(re,te,ne,!1,null,null,null),ae=oe.exports;i["a"].use(d["a"]);var ce=[{path:"/",name:"endpoint",component:L},{path:"/nginxFlvTest",name:"nginxFlvTest",component:ee},{path:"/test",name:"test",component:ae}],se=new d["a"]({mode:"hash",base:"",routes:ce}),le=se,de=n("7c78");i["a"].prototype.$qsParse=de["parse"],i["a"].prototype.$qsStringify=de["stringify"],i["a"].config.productionTip=!1,new i["a"]({router:le,render:function(e){return e(l)}}).$mount("#app")},"974d":function(e,t,n){},"9cac":function(e,t,n){"use strict";n("2091")},ddf8:function(e,t,n){"use strict";n("974d")}});